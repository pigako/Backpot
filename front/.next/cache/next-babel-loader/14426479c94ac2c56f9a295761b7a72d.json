{"ast":null,"code":"function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { all, call, fork, throttle, takeLatest, put } from 'redux-saga/effects';\nimport axios from 'axios';\nimport { LOAD_BOOKS_REQUEST, LOAD_BOOKS_SUCCESS, LOAD_BOOKS_FAILURE, LOAD_BOOK_REQUEST, LOAD_BOOK_SUCCESS, LOAD_BOOK_FAILURE, ADD_LIKEBOOK_REQUEST, ADD_LIKEBOOK_SUCCESS, ADD_LIKEBOOK_FAILURE, REMOVE_LIKEBOOK_REQUEST, REMOVE_LIKEBOOK_SUCCESS, REMOVE_LIKEBOOK_FAILURE, UPLOAD_IMAGE_REQUEST, UPLOAD_IMAGE_SUCCESS, UPLOAD_IMAGE_FAILURE, ADD_BOOK_REQUEST, ADD_BOOK_FAILURE, ADD_BOOK_SUCCESS, LOAD_GENRE_REQUEST, LOAD_GENRE_SUCCESS, LOAD_GENRE_FAILURE, UPDATE_BOOK_REQUEST, UPDATE_BOOK_SUCCESS, UPDATE_BOOK_FAILURE, DELETE_BOOK_REQUEST, DELETE_BOOK_SUCCESS, DELETE_BOOK_FAILURE } from '../reducers/book';\nimport { ADD_LIKEBOOKLIST, REMOVE_LIKEBOOKLIST } from '../reducers/user'; // 전체 연재글 가져오기\n\nfunction* watchLoadBooks() {\n  yield throttle(1000, LOAD_BOOKS_REQUEST, function* loadBooks(action) {\n    try {\n      const result = yield call((lastId = 0, keyword = '', limit = 20) => {\n        return axios.get(`/books?keyword=${keyword}`);\n      }, action.keyword);\n      yield put({\n        type: LOAD_BOOKS_SUCCESS,\n        data: result.data\n      });\n    } catch (e) {\n      console.log(e);\n      yield put({\n        type: LOAD_BOOKS_FAILURE,\n        error: e\n      });\n    }\n  });\n} // 게시글 하나 조회\n\n\nfunction* watchLoadBook() {\n  yield takeLatest(LOAD_BOOK_REQUEST, function* loadBook(action) {\n    try {\n      const result = yield call(bookId => {\n        return axios.get(`/book/${bookId}`);\n      }, action.id);\n      yield put({\n        type: LOAD_BOOK_SUCCESS,\n        data: result.data\n      });\n    } catch (e) {\n      console.log(e);\n      put({\n        type: LOAD_BOOK_FAILURE,\n        error: e\n      });\n    }\n  });\n} // 선호작 추가\n\n\nfunction* watchAddLikebook() {\n  yield takeLatest(ADD_LIKEBOOK_REQUEST, function* addLikebook(action) {\n    try {\n      const result = yield call(bookId => {\n        return axios.post(`/book/${bookId}/like`, {}, {\n          withCredentials: true\n        });\n      }, action.bookId);\n      yield put({\n        type: ADD_LIKEBOOK_SUCCESS,\n        data: result.data\n      });\n      yield put({\n        type: ADD_LIKEBOOKLIST,\n        data: _objectSpread({\n          id: result.data\n        }, action.data)\n      });\n    } catch (e) {\n      console.log(e);\n      yield put({\n        type: ADD_LIKEBOOK_FAILURE,\n        error: e\n      });\n    }\n  });\n} // 선호작 해제\n\n\nfunction* watchRemoveLikebook() {\n  yield takeLatest(REMOVE_LIKEBOOK_REQUEST, function* removeLikebook(action) {\n    try {\n      const result = yield call(bookId => {\n        return axios.delete(`/book/${bookId}/unlike`, {\n          withCredentials: true\n        });\n      }, action.bookId);\n      yield put({\n        type: REMOVE_LIKEBOOK_SUCCESS,\n        data: result.data\n      });\n      yield put({\n        type: REMOVE_LIKEBOOKLIST,\n        data: result.data\n      });\n    } catch (e) {\n      console.log(e);\n      put({\n        type: REMOVE_LIKEBOOK_FAILURE,\n        error: e\n      });\n    }\n  });\n} // 썸네일 이미지 업로드\n\n\nfunction* watchUploadImage() {\n  yield takeLatest(UPLOAD_IMAGE_REQUEST, function* uploadImage(action) {\n    try {\n      const result = yield call(formData => {\n        return axios.post('/book/thumbnail', formData, {\n          withCredentials: true\n        });\n      }, action.data);\n      yield put({\n        type: UPLOAD_IMAGE_SUCCESS,\n        data: result.data\n      });\n    } catch (e) {\n      console.log(e);\n      yield put({\n        type: UPLOAD_IMAGE_FAILURE,\n        error: e\n      });\n    }\n  });\n} // 작품 만들기\n\n\nfunction* watchAddBook() {\n  yield takeLatest(ADD_BOOK_REQUEST, function* addBook(action) {\n    try {\n      const result = yield call(bookData => {\n        return axios.post('/book', bookData, {\n          withCredentials: true\n        });\n      }, action.data);\n      yield put({\n        type: ADD_BOOK_SUCCESS,\n        data: result.data\n      });\n    } catch (e) {\n      console.log(e);\n      yield put({\n        type: ADD_BOOK_FAILURE,\n        error: e\n      });\n    }\n  });\n} // 장르 조회\n\n\nfunction* watchLoadGenre() {\n  yield takeLatest(LOAD_GENRE_REQUEST, function* loadGenre() {\n    try {\n      const result = yield call(() => {\n        return axios.get('/genres');\n      });\n      yield put({\n        type: LOAD_GENRE_SUCCESS,\n        data: result.data\n      });\n    } catch (e) {\n      console.log(e);\n      yield put({\n        type: LOAD_GENRE_FAILURE,\n        error: e\n      });\n    }\n  });\n} // 작품 수정\n\n\nfunction* watchUpdateBook() {\n  yield takeLatest(UPDATE_BOOK_REQUEST, function* updateBook(action) {\n    try {\n      const result = yield call(bookData => {\n        return axios.patch(`/book`, bookData, {\n          withCredentials: true\n        });\n      }, action.data);\n      yield put({\n        type: UPDATE_BOOK_SUCCESS,\n        data: result.data\n      });\n    } catch (e) {\n      console.log(e);\n      yield put({\n        type: UPDATE_BOOK_FAILURE,\n        error: e\n      });\n    }\n  });\n}\n\nfunction* watchDeleteBook() {\n  yield takeLatest(DELETE_BOOK_REQUEST, function* deleteBook(action) {\n    try {\n      const result = yield call(bookId => {\n        return axios.delete(`/book/${bookId}`, {\n          withCredentials: true\n        });\n      }, action.id);\n      yield put({\n        type: DELETE_BOOK_SUCCESS,\n        data: result.data\n      });\n      yield put({\n        type: REMOVE_LIKEBOOKLIST,\n        data: action.id\n      });\n    } catch (e) {\n      console.log(e);\n      yield put({\n        type: DELETE_BOOK_FAILURE,\n        error: e\n      });\n    }\n  });\n}\n\nexport default function* bookSaga() {\n  yield all([fork(watchLoadBooks), fork(watchLoadBook), fork(watchAddLikebook), fork(watchRemoveLikebook), fork(watchUploadImage), fork(watchAddBook), fork(watchLoadGenre), fork(watchUpdateBook), fork(watchDeleteBook)]);\n}","map":{"version":3,"sources":["C:/Document/Backpot/front/sagas/book.js"],"names":["all","call","fork","throttle","takeLatest","put","axios","LOAD_BOOKS_REQUEST","LOAD_BOOKS_SUCCESS","LOAD_BOOKS_FAILURE","LOAD_BOOK_REQUEST","LOAD_BOOK_SUCCESS","LOAD_BOOK_FAILURE","ADD_LIKEBOOK_REQUEST","ADD_LIKEBOOK_SUCCESS","ADD_LIKEBOOK_FAILURE","REMOVE_LIKEBOOK_REQUEST","REMOVE_LIKEBOOK_SUCCESS","REMOVE_LIKEBOOK_FAILURE","UPLOAD_IMAGE_REQUEST","UPLOAD_IMAGE_SUCCESS","UPLOAD_IMAGE_FAILURE","ADD_BOOK_REQUEST","ADD_BOOK_FAILURE","ADD_BOOK_SUCCESS","LOAD_GENRE_REQUEST","LOAD_GENRE_SUCCESS","LOAD_GENRE_FAILURE","UPDATE_BOOK_REQUEST","UPDATE_BOOK_SUCCESS","UPDATE_BOOK_FAILURE","DELETE_BOOK_REQUEST","DELETE_BOOK_SUCCESS","DELETE_BOOK_FAILURE","ADD_LIKEBOOKLIST","REMOVE_LIKEBOOKLIST","watchLoadBooks","loadBooks","action","result","lastId","keyword","limit","get","type","data","e","console","log","error","watchLoadBook","loadBook","bookId","id","watchAddLikebook","addLikebook","post","withCredentials","watchRemoveLikebook","removeLikebook","delete","watchUploadImage","uploadImage","formData","watchAddBook","addBook","bookData","watchLoadGenre","loadGenre","watchUpdateBook","updateBook","patch","watchDeleteBook","deleteBook","bookSaga"],"mappings":"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","sourcesContent":["import { all, call, fork, throttle, takeLatest, put } from 'redux-saga/effects';\r\nimport axios from 'axios';\r\nimport {\r\n  LOAD_BOOKS_REQUEST,\r\n  LOAD_BOOKS_SUCCESS,\r\n  LOAD_BOOKS_FAILURE,\r\n  LOAD_BOOK_REQUEST,\r\n  LOAD_BOOK_SUCCESS,\r\n  LOAD_BOOK_FAILURE,\r\n  ADD_LIKEBOOK_REQUEST,\r\n  ADD_LIKEBOOK_SUCCESS,\r\n  ADD_LIKEBOOK_FAILURE,\r\n  REMOVE_LIKEBOOK_REQUEST,\r\n  REMOVE_LIKEBOOK_SUCCESS,\r\n  REMOVE_LIKEBOOK_FAILURE,\r\n  UPLOAD_IMAGE_REQUEST,\r\n  UPLOAD_IMAGE_SUCCESS,\r\n  UPLOAD_IMAGE_FAILURE,\r\n  ADD_BOOK_REQUEST,\r\n  ADD_BOOK_FAILURE,\r\n  ADD_BOOK_SUCCESS,\r\n  LOAD_GENRE_REQUEST,\r\n  LOAD_GENRE_SUCCESS,\r\n  LOAD_GENRE_FAILURE,\r\n  UPDATE_BOOK_REQUEST,\r\n  UPDATE_BOOK_SUCCESS,\r\n  UPDATE_BOOK_FAILURE,\r\n  DELETE_BOOK_REQUEST,\r\n  DELETE_BOOK_SUCCESS,\r\n  DELETE_BOOK_FAILURE,\r\n} from '../reducers/book';\r\nimport { ADD_LIKEBOOKLIST, REMOVE_LIKEBOOKLIST } from '../reducers/user';\r\n\r\n// 전체 연재글 가져오기\r\nfunction* watchLoadBooks() {\r\n  yield throttle(1000, LOAD_BOOKS_REQUEST, function* loadBooks(action) {\r\n    try {\r\n      const result = yield call((lastId = 0, keyword = '', limit = 20) => {\r\n        return axios.get(`/books?keyword=${keyword}`);\r\n      }, action.keyword);\r\n      yield put({\r\n        type: LOAD_BOOKS_SUCCESS,\r\n        data: result.data,\r\n      });\r\n    } catch (e) {\r\n      console.log(e);\r\n      yield put({\r\n        type: LOAD_BOOKS_FAILURE,\r\n        error: e,\r\n      });\r\n    }\r\n  });\r\n}\r\n// 게시글 하나 조회\r\nfunction* watchLoadBook() {\r\n  yield takeLatest(LOAD_BOOK_REQUEST, function* loadBook(action) {\r\n    try {\r\n      const result = yield call(bookId => {\r\n        return axios.get(`/book/${bookId}`);\r\n      }, action.id);\r\n      yield put({\r\n        type: LOAD_BOOK_SUCCESS,\r\n        data: result.data,\r\n      });\r\n    } catch (e) {\r\n      console.log(e);\r\n      put({\r\n        type: LOAD_BOOK_FAILURE,\r\n        error: e,\r\n      });\r\n    }\r\n  });\r\n}\r\n// 선호작 추가\r\nfunction* watchAddLikebook() {\r\n  yield takeLatest(ADD_LIKEBOOK_REQUEST, function* addLikebook(action) {\r\n    try {\r\n      const result = yield call(bookId => {\r\n        return axios.post(\r\n          `/book/${bookId}/like`,\r\n          {},\r\n          {\r\n            withCredentials: true,\r\n          },\r\n        );\r\n      }, action.bookId);\r\n      yield put({\r\n        type: ADD_LIKEBOOK_SUCCESS,\r\n        data: result.data,\r\n      });\r\n      yield put({\r\n        type: ADD_LIKEBOOKLIST,\r\n        data: {\r\n          id: result.data,\r\n          ...action.data,\r\n        },\r\n      });\r\n    } catch (e) {\r\n      console.log(e);\r\n      yield put({\r\n        type: ADD_LIKEBOOK_FAILURE,\r\n        error: e,\r\n      });\r\n    }\r\n  });\r\n}\r\n// 선호작 해제\r\nfunction* watchRemoveLikebook() {\r\n  yield takeLatest(REMOVE_LIKEBOOK_REQUEST, function* removeLikebook(action) {\r\n    try {\r\n      const result = yield call(bookId => {\r\n        return axios.delete(`/book/${bookId}/unlike`, {\r\n          withCredentials: true,\r\n        });\r\n      }, action.bookId);\r\n      yield put({\r\n        type: REMOVE_LIKEBOOK_SUCCESS,\r\n        data: result.data,\r\n      });\r\n      yield put({\r\n        type: REMOVE_LIKEBOOKLIST,\r\n        data: result.data,\r\n      });\r\n    } catch (e) {\r\n      console.log(e);\r\n      put({\r\n        type: REMOVE_LIKEBOOK_FAILURE,\r\n        error: e,\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\n// 썸네일 이미지 업로드\r\nfunction* watchUploadImage() {\r\n  yield takeLatest(UPLOAD_IMAGE_REQUEST, function* uploadImage(action) {\r\n    try {\r\n      const result = yield call(formData => {\r\n        return axios.post('/book/thumbnail', formData, {\r\n          withCredentials: true,\r\n        });\r\n      }, action.data);\r\n      yield put({\r\n        type: UPLOAD_IMAGE_SUCCESS,\r\n        data: result.data,\r\n      });\r\n    } catch (e) {\r\n      console.log(e);\r\n      yield put({\r\n        type: UPLOAD_IMAGE_FAILURE,\r\n        error: e,\r\n      });\r\n    }\r\n  });\r\n}\r\n// 작품 만들기\r\nfunction* watchAddBook() {\r\n  yield takeLatest(ADD_BOOK_REQUEST, function* addBook(action) {\r\n    try {\r\n      const result = yield call(bookData => {\r\n        return axios.post('/book', bookData, {\r\n          withCredentials: true,\r\n        });\r\n      }, action.data);\r\n      yield put({\r\n        type: ADD_BOOK_SUCCESS,\r\n        data: result.data,\r\n      });\r\n    } catch (e) {\r\n      console.log(e);\r\n      yield put({\r\n        type: ADD_BOOK_FAILURE,\r\n        error: e,\r\n      });\r\n    }\r\n  });\r\n}\r\n// 장르 조회\r\nfunction* watchLoadGenre() {\r\n  yield takeLatest(LOAD_GENRE_REQUEST, function* loadGenre() {\r\n    try {\r\n      const result = yield call(() => {\r\n        return axios.get('/genres');\r\n      });\r\n      yield put({\r\n        type: LOAD_GENRE_SUCCESS,\r\n        data: result.data,\r\n      });\r\n    } catch (e) {\r\n      console.log(e);\r\n      yield put({\r\n        type: LOAD_GENRE_FAILURE,\r\n        error: e,\r\n      });\r\n    }\r\n  });\r\n}\r\n// 작품 수정\r\nfunction* watchUpdateBook() {\r\n  yield takeLatest(UPDATE_BOOK_REQUEST, function* updateBook(action) {\r\n    try {\r\n      const result = yield call(bookData => {\r\n        return axios.patch(`/book`, bookData, {\r\n          withCredentials: true,\r\n        });\r\n      }, action.data);\r\n      yield put({\r\n        type: UPDATE_BOOK_SUCCESS,\r\n        data: result.data,\r\n      });\r\n    } catch (e) {\r\n      console.log(e);\r\n      yield put({\r\n        type: UPDATE_BOOK_FAILURE,\r\n        error: e,\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\nfunction* watchDeleteBook() {\r\n  yield takeLatest(DELETE_BOOK_REQUEST, function* deleteBook(action) {\r\n    try {\r\n      const result = yield call(bookId => {\r\n        return axios.delete(`/book/${bookId}`, {\r\n          withCredentials: true,\r\n        });\r\n      }, action.id);\r\n      yield put({\r\n        type: DELETE_BOOK_SUCCESS,\r\n        data: result.data,\r\n      });\r\n      yield put({\r\n        type: REMOVE_LIKEBOOKLIST,\r\n        data: action.id,\r\n      });\r\n    } catch (e) {\r\n      console.log(e);\r\n      yield put({\r\n        type: DELETE_BOOK_FAILURE,\r\n        error: e,\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\nexport default function* bookSaga() {\r\n  yield all([\r\n    fork(watchLoadBooks),\r\n    fork(watchLoadBook),\r\n    fork(watchAddLikebook),\r\n    fork(watchRemoveLikebook),\r\n    fork(watchUploadImage),\r\n    fork(watchAddBook),\r\n    fork(watchLoadGenre),\r\n    fork(watchUpdateBook),\r\n    fork(watchDeleteBook),\r\n  ]);\r\n}\r\n"]},"metadata":{},"sourceType":"module"}