{"version":3,"file":"static/webpack/static\\development\\pages\\episode\\update.js.c57db1eada83d32f6e85.hot-update.js","sources":["webpack:///./pages/episode/update.js"],"sourcesContent":["import React, { useState, useEffect, useRef, useCallback } from 'react';\r\nimport styled from 'styled-components';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport Helmet from 'react-helmet';\r\nimport Router from 'next/router';\r\n\r\nimport Button from '../../components/designs/Button';\r\nimport {\r\n  UPDATE_EPISODE_REQUEST,\r\n  CHANGE_UPDATEDEPISODE,\r\n  LOAD_EPISODE_REQUEST,\r\n} from '../../reducers/episode';\r\n\r\nconst UpdateEpisodeDiv = styled.div`\r\n  width: 98%;\r\n  margin: 1rem 0rem 0rem 1rem;\r\n`;\r\n\r\nconst UpdateEpisodeTopDiv = styled.div`\r\n  position: relative;\r\n\r\n  margin-bottom: 2rem;\r\n`;\r\n\r\nconst BookTitle = styled.h1`\r\n  font-weight: bold;\r\n  font-size: 1rem;\r\n  margin-bottom: 1rem;\r\n`;\r\n\r\nconst TopButtonDiv = styled.div`\r\n  position: absolute;\r\n  top: 5%;\r\n  right: 1%;\r\n`;\r\n\r\nconst EpisodeForm = styled.form``;\r\n\r\nconst UpdateEpisodeContentDiv = styled.div`\r\n  margin: 1.5rem;\r\n`;\r\n\r\nconst DivCard = styled.div`\r\n  display: flex;\r\n  align-items: center;\r\n  margin: 1rem;\r\n\r\n  width: 100%;\r\n`;\r\nconst DivCardLeft = styled.div`\r\n  flex: 1;\r\n`;\r\nconst DivCardRight = styled.div`\r\n  flex: 4;\r\n  display: flex;\r\n\r\n  & > input {\r\n    width: calc(100% - 2rem);\r\n    height: 2rem;\r\n    font-size: 1rem;\r\n    line-height: 2rem;\r\n    padding-left: 10px;\r\n\r\n    border: solid 2px #495057;\r\n    border-radius: 4px;\r\n\r\n    transition: 0.55s ease;\r\n    & :hover {\r\n      border: solid 2px #148cff;\r\n    }\r\n    & :focus {\r\n      border: solid 2px #148cff;\r\n    }\r\n  }\r\n`;\r\n\r\nconst CheckBox = styled.input`\r\n  width: 1.5rem !important;\r\n  height: 1.5rem !important;\r\n`;\r\n\r\nconst UpdateEditorDiv = styled.div`\r\n  margin: 1rem;\r\n  & > label {\r\n    width: 100%;\r\n    display: inline-block;\r\n    margin-bottom: 1rem;\r\n    padding-bottom: 1rem;\r\n    border-bottom: solid 2px #495057;\r\n  }\r\n`;\r\n\r\nconst Update = () => {\r\n  const { episode, isUpdatingEpisode, isUpdatedEpisode } = useSelector(\r\n    state => state.episode,\r\n  );\r\n\r\n  const dispatch = useDispatch();\r\n\r\n  const [checkNotice, setCheckNotice] = useState(\r\n    episode && episode.isNotice === 1 ? true : false,\r\n  );\r\n  const [title, setTitle] = useState(episode && episode.title);\r\n  const [text, setText] = useState(\r\n    episode &&\r\n      episode.content.split(\r\n        '<br/><br/><p><strong>작가의 말</strong><hr><br/>',\r\n      )[0],\r\n  );\r\n  const [writerComment, setWriterComment] = useState(\r\n    (episode &&\r\n      episode.content.split(\r\n        '<br/><br/><p><strong>작가의 말</strong><hr><br/>',\r\n      )[1]) ||\r\n      '',\r\n  );\r\n\r\n  const onChangeCheckNotice = useCallback(() => {\r\n    setCheckNotice(!checkNotice);\r\n  }, [checkNotice]);\r\n\r\n  const onChangeTitle = useCallback(e => {\r\n    setTitle(e.target.value);\r\n  }, []);\r\n\r\n  const editorRef = useRef();\r\n  const [editorLoded, setEditorLoded] = useState(false);\r\n  const { CKEditor, ClassicEditor } = editorRef.current || {};\r\n\r\n  useEffect(() => {\r\n    editorRef.current = {\r\n      CKEditor: require('@ckeditor/ckeditor5-react'),\r\n      ClassicEditor: require('@ckeditor/ckeditor5-build-classic'),\r\n    };\r\n    setEditorLoded(true);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (isUpdatedEpisode) {\r\n      dispatch({\r\n        type: CHANGE_UPDATEDEPISODE,\r\n      });\r\n      Router.push(\r\n        { pathname: `/episode`, query: { id: episode.id } },\r\n        `/episode/${episode.id}`,\r\n      );\r\n    }\r\n  }, [isUpdatedEpisode, episode && episode.id]);\r\n\r\n  const onCancleUpdate = useCallback(() => {\r\n    Router.back();\r\n  }, []);\r\n\r\n  //\r\n  const onWriteEpisode = useCallback(\r\n    e => {\r\n      e.preventDefault();\r\n      const episodeContent =\r\n        text +\r\n        '<br/><br/><p><strong>작가의 말</strong><hr><br/>' +\r\n        writerComment;\r\n      dispatch({\r\n        type: UPDATE_EPISODE_REQUEST,\r\n        data: {\r\n          id: episode && episode.id,\r\n          title: title,\r\n          content: episodeContent,\r\n          notice: checkNotice ? 1 : 0,\r\n        },\r\n      });\r\n    },\r\n    [episode && episode.id, checkNotice, title, text, writerComment],\r\n  );\r\n\r\n  return (\r\n    <UpdateEpisodeDiv>\r\n      <Helmet>\r\n        <title>{episode && episode.title}</title>\r\n        <style type=\"text/css\">\r\n          {`\r\n            .ck.ck-editor {width:100%;}\r\n            .ck-editor__editable { height: 500px;}\r\n          `}\r\n        </style>\r\n      </Helmet>\r\n      <EpisodeForm onSubmit={onWriteEpisode}>\r\n        <UpdateEpisodeTopDiv>\r\n          <BookTitle>{episode && episode.title}</BookTitle>\r\n          <TopButtonDiv>\r\n            <Button color=\"pink\" type=\"button\" onClick={onCancleUpdate}>\r\n              취소\r\n            </Button>\r\n            <Button type=\"submit\">작성</Button>\r\n          </TopButtonDiv>\r\n        </UpdateEpisodeTopDiv>\r\n        <UpdateEpisodeContentDiv>\r\n          <DivCard>\r\n            <DivCardLeft>\r\n              <label>이 글을 공지로 작성</label>\r\n            </DivCardLeft>\r\n            <DivCardRight>\r\n              <CheckBox\r\n                type=\"checkbox\"\r\n                value={checkNotice}\r\n                onChange={onChangeCheckNotice}\r\n              />\r\n            </DivCardRight>\r\n          </DivCard>\r\n          <DivCard>\r\n            <DivCardLeft>\r\n              <label>제목</label>\r\n            </DivCardLeft>\r\n            <DivCardRight>\r\n              <input type=\"text\" value={title} onChange={onChangeTitle} />\r\n            </DivCardRight>\r\n          </DivCard>\r\n\r\n          <UpdateEditorDiv>\r\n            <label>본문</label>\r\n            {editorLoded ? (\r\n              <CKEditor\r\n                editor={ClassicEditor}\r\n                data={text}\r\n                onChange={(event, editor) => {\r\n                  const data = editor.getData();\r\n                  setText(data);\r\n                }}\r\n              />\r\n            ) : (\r\n              <p>Editor Loding</p>\r\n            )}\r\n          </UpdateEditorDiv>\r\n          <UpdateEditorDiv>\r\n            <label>작가의 말</label>\r\n            {editorLoded ? (\r\n              <CKEditor\r\n                editor={ClassicEditor}\r\n                data={writerComment}\r\n                onChange={(event, editor) => {\r\n                  const data = editor.getData();\r\n                  setWriterComment(data);\r\n                }}\r\n              />\r\n            ) : (\r\n              <p>Editor Loding</p>\r\n            )}\r\n          </UpdateEditorDiv>\r\n        </UpdateEpisodeContentDiv>\r\n      </EpisodeForm>\r\n    </UpdateEpisodeDiv>\r\n  );\r\n};\r\n\r\nUpdate.getInitialProps = async context => {\r\n  const episodeId = context.query.episodeid;\r\n\r\n  context.store.dispatch({\r\n    type: LOAD_EPISODE_REQUEST,\r\n    id: episodeId,\r\n  });\r\n};\r\n\r\nexport default Update;\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAMA;AAAA;AAAA;AAAA;AAKA;AAAA;AAAA;AAAA;AAMA;AAAA;AAAA;AAAA;AAMA;AAAA;AAAA;AAAA;AAMA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAOA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAwBA;AAAA;AAAA;AAAA;AAKA;AAAA;AAAA;AAAA;AACA;AAUA;AAAA;AAEA;AAAA;AAFA;AAAA;AAAA;AACA;AAIA;AACA;AANA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AAwBA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAlCA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AAoCA;AACA;AACA;AACA;AAFA;AAIA;AACA;AAEA;AACA;AACA;AACA;AADA;AAGA;AACA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAFA;AASA;AAIA;AAIA;AAAA;AAOA;AAAA;AAIA;AAAA;AAAA;AAAA;AAGA;AAAA;AAUA;AACA;AACA;AAHA;AAYA;AAAA;AAAA;AAAA;AAQA;AACA;AACA;AACA;AACA;AACA;AANA;AAgBA;AACA;AACA;AACA;AACA;AACA;AANA;AAgBA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AAFA;AACA;AAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAQA;;;;A","sourceRoot":""}